주문 생성 시스템 - 요구사항 분석 및 설계                                                                                                 │
│                                                                                                                                          │
│ Context                                                                                                                                  │
│                                                                                                                                          │
│ 현재 시스템에는 Example, Member 도메인만 존재하며, 커머스의 핵심인 상품/재고/주문 도메인이 없다.                                         │
│ "여러 상품을 한 번에 주문할 때, 재고와 주문 상태 사이의 불일치가 발생하지 않도록" All-or-Nothing 정책으로 주문 생성 기능을 구현해야      │
│ 한다.                                                                                                                                    │
│                                                                                                                                          │
│ ---                                                                                                                                      │
│ 1️⃣문제 상황 재해석                                                                                                                      │
│                                                                                                                                          │
│ 사용자 관점: 여러 상품을 한 번에 주문했는데 일부만 처리되면 혼란. 되거나/안 되거나 명확한 결과를 기대한다.                               │
│                                                                                                                                          │
│ 비즈니스 관점: 재고-주문 불일치는 클레임 직결. 재고 확인과 주문 생성이 원자적으로 묶여야 하며, 향후 부분취소 확장도 고려해야 한다.       │
│                                                                                                                                          │
│ 시스템 관점: Order + OrderItem 생성 + 재고 차감이 단일 트랜잭션으로 처리되어야 한다. FK 없이 ID 참조로 느슨한 결합 유지, 스냅샷으로 시점 │
│  정합성 보장.                                                                                                                            │
│                                                                                                                                          │
│ ---                                                                                                                                      │
│ 2️⃣합의된 설계 결정                                                                                                                      │
│ ┌─────────────────────┬─────────────────────────────────────────────────────────────────────────────┐                                    │
│ │        항목         │                                    결정                                     │                                    │
│ ├─────────────────────┼─────────────────────────────────────────────────────────────────────────────┤                                    │
│ │ Product/Stock/Brand │ 주문과 함께 새로 생성                                                       │                                    │
│ ├─────────────────────┼─────────────────────────────────────────────────────────────────────────────┤                                    │
│ │ Product 구조        │ Product + Brand 별도 엔티티 분리                                            │                                    │
│ ├─────────────────────┼─────────────────────────────────────────────────────────────────────────────┤                                    │
│ │ Stock 구조          │ 별도 Stock 엔티티 (productId, quantity)                                     │                                    │
│ ├─────────────────────┼─────────────────────────────────────────────────────────────────────────────┤                                    │
│ │ OrderStatus         │ Enum 미리 정의 (CREATED, CONFIRMED, CANCELLED), 전이 로직은 CREATED까지만   │                                    │
│ ├─────────────────────┼─────────────────────────────────────────────────────────────────────────────┤                                    │
│ │ OrderItemStatus     │ Enum 미리 정의 (ORDERED, CANCELLED) — 부분취소 확장성                       │                                    │
│ ├─────────────────────┼─────────────────────────────────────────────────────────────────────────────┤                                    │
│ │ 동시성 제어         │ 비관적 락 (SELECT FOR UPDATE on Stock)                                      │                                    │
│ ├─────────────────────┼─────────────────────────────────────────────────────────────────────────────┤                                    │
│ │ 인증                │ 기존 X-Loopers-LoginId 헤더 인증                                            │                                    │
│ ├─────────────────────┼─────────────────────────────────────────────────────────────────────────────┤                                    │
│ │ FK 제약조건         │ 없음, ID 참조만                                                             │                                    │
│ ├─────────────────────┼─────────────────────────────────────────────────────────────────────────────┤                                    │
│ │ Value Objects       │ Money (가격/금액), Quantity (수량), ProductSnapshot (주문 시점 상품 스냅샷) │                                    │
│ ├─────────────────────┼─────────────────────────────────────────────────────────────────────────────┤                                    │
│ │ 도메인 서비스       │ StockDeductionService — 재고 차감 검증 로직 분리                            │                                    │
│ └─────────────────────┴─────────────────────────────────────────────────────────────────────────────┘                                    │
│ ---                                                                                                                                      │
│ 3️⃣개념 모델                                                                                                                             │
│                                                                                                                                          │
│ 액터                                                                                                                                     │
│ - 사용자 (회원): 주문을 생성하는 주체                                                                                                    │
│ - 관리자 (미구현): 상품/브랜드/재고를 관리하는 주체 (테스트 데이터로 대체)                                                               │
│                                                                                                                                          │
│ 핵심 도메인                                                                                                                              │
│ - Order (주문): 주문 생성, 상태 관리                                                                                                     │
│ - OrderItem (주문 항목): 개별 상품 주문 정보 + ProductSnapshot VO                                                                        │
│ - Stock (재고): 재고 수량 관리, 동시성 제어 대상                                                                                         │
│                                                                                                                                          │
│ 보조 도메인                                                                                                                              │
│ - Product (상품): 상품 정보 제공                                                                                                         │
│ - Brand (브랜드): 브랜드 정보 제공                                                                                                       │
│ - Member (회원): 인증, 주문자 식별 (기존 구현)                                                                                           │
│                                                                                                                                          │
│ Value Objects                                                                                                                            │
│ - Money: 가격/금액을 감싸는 VO. value >= 0 불변식 보장. Product.price, Order.totalAmount, ProductSnapshot.price에 사용                   │
│ - Quantity: 수량을 감싸는 VO. value > 0 불변식 보장. OrderItem.quantity에 사용                                                           │
│ - ProductSnapshot: 주문 시점 상품 정보(@Embeddable). productName, price(Money), brandName을 묶어 OrderItem에 내장                        │
│                                                                                                                                          │
│ 도메인 서비스                                                                                                                            │
│ - StockDeductionService: 여러 Stock 엔티티에 걸친 All-or-Nothing 재고 차감을 담당. 단일 엔티티에 속하지 않는 크로스 엔티티 비즈니스      │
│ 로직.                                                                                                                                    │
│                 